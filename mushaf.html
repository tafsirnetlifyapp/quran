<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Quran Copy Unicode</title>
  <style>
    body {
      background: #fefdf8;
      text-align: center;
      padding: 2em;
      direction: rtl;
      font-family: sans-serif;
    }

    #ayah-visual {
      font-family: 'QCF_P002', serif;
      font-size: 3em;
      user-select: text;
    }

    #ayah-unicode {
      position: absolute;
      left: -9999px;
      white-space: nowrap;
    }

    @font-face {
      font-family: 'QCF_P002';
      src: url('https://dickymiswardi.github.io/tadabbur/QCF_P002.TTF') format('truetype');
      font-display: swap;
    }
  </style>
</head>
<body>

  <h1>نص القرآن الكريم</h1>

  <div id="ayah-visual">جارٍ التحميل...</div>
  <div id="ayah-unicode"></div>

  <script>
    const surah = 1, ayah = 1;

    // Load XML lokal
    fetch("https://dickymiswardi.github.io/tadabbur/quran-uthmani.xml")
      .then(res => res.text())
      .then(xmlText => {
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "text/xml");

        // Ambil teks Unicode dari XML
        const aya = xml.querySelector(`sura[index="${surah}"] > aya[index="${ayah}"]`);
        const text = aya?.getAttribute("text") || "(Ayat tidak ditemukan)";
        document.getElementById("ayah-unicode").innerText = text;

        // Tampilkan visual Mushaf pakai API
        fetch(`https://api.quran.com/api/v4/verses/by_key/${surah}:${ayah}?words=true`)
          .then(res => res.json())
          .then(data => {
            const codeV1 = data.verse.words.map(w => w.code_v1 || w.text).join(' ');
            document.getElementById("ayah-visual").innerText = codeV1;
          });
      });

    // Override copy manual
    document.addEventListener('copy', function (e) {
      const selection = window.getSelection().toString();
      const visualText = document.getElementById("ayah-visual").innerText;
      if (visualText.includes(selection.trim())) {
        const unicode = document.getElementById("ayah-unicode").innerText;
        e.clipboardData.setData("text/plain", unicode);
        e.preventDefault();
        console.log("✅ Teks yang dicopy diganti dengan Unicode dari XML");
      }
    });
  </script>

</body>
</html>
