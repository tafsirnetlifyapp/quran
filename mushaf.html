<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Mushaf Ayat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #fefcf8;
      padding: 1em;
      font-family: sans-serif;
      direction: rtl;
    }

    h2 { text-align: center; }

    .controls {
      direction: ltr;
      max-width: 720px;
      margin: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 1em;
      justify-content: center;
      align-items: flex-end;
    }

    label {
      font-size: 0.9em;
    }

    select {
      font-size: 1em;
      padding: 0.5em;
    }

    .page-container {
      font-size: 2.5em;
      line-height: 1.6;
      text-align: justify;
      user-select: text;
      margin: 2em auto;
      opacity: 0;
      transition: opacity 0.3s ease;
      display: none;
      word-spacing: 0.2em;
      max-width: 700px;
    }

    .word {
      display: inline-block;
      position: relative;
      margin: 0 0.1em;
      cursor: pointer;
    }

    .word:hover {
      background-color: #f7eacb;
      border-radius: 6px;
    }

    .translation {
      position: absolute;
      bottom: -2.4em;
      font-size: 0.45em;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.3em 0.6em;
      white-space: nowrap;
      display: none;
      z-index: 10;
      color: #444;
    }

    .word.active .translation {
      display: block;
    }

    @media (max-width: 768px) {
      .page-container { font-size: 1.5em; }
    }
  </style>
</head>
<body>

<h2>📖 Al-Qur'an Dinamis</h2>

<div class="controls">
  <label>Surah
    <select id="surahSelect"></select>
  </label>
  <label>Ayat
    <select id="ayahSelect"></select>
  </label>
  <label>Jumlah Kata
    <select id="wordCount">
      <option value="0">Semua</option>
    </select>
  </label>
</div>

<div id="pages"></div>

<script>
const surahList = {
  1:["Al-Fātiḥah",7], 2:["Al-Baqarah",286], 3:["Āl ʿImrān",200], 4:["An-Nisāʾ",176],
  5:["Al-Māʾidah",120], 6:["Al-Anʿām",165], 7:["Al-Aʿrāf",206], 8:["Al-Anfāl",75],
  9:["At-Tawbah",129], 10:["Yūnus",109], 11:["Hūd",123], 12:["Yūsuf",111], 13:["Ar-Raʿd",43],
  14:["Ibrāhīm",52], 15:["Al-Ḥijr",99], 16:["An-Naḥl",128], 17:["Al-Isrāʾ",111],
  18:["Al-Kahf",110], 19:["Maryam",98], 20:["Ṭā-Hā",135], 21:["Al-Anbiyāʾ",112],
  22:["Al-Ḥajj",78], 23:["Al-Muʾminūn",118], 24:["An-Nūr",64], 25:["Al-Furqān",77],
  26:["Ash-Shuʿarāʾ",227], 27:["An-Naml",93], 28:["Al-Qaṣaṣ",88], 29:["Al-ʿAnkabūt",69],
  30:["Ar-Rūm",60], 31:["Luqmān",34], 32:["As-Sajdah",30], 33:["Al-Aḥzāb",73],
  34:["Sabaʾ",54], 35:["Fāṭir",45], 36:["Yā-Sīn",83], 37:["As-Ṣāffāt",182],
  38:["Ṣād",88], 39:["Az-Zumar",75], 40:["Ghāfir",85], 41:["Fuṣṣilat",54], 42:["Ash-Shūrā",53],
  43:["Az-Zukhruf",89], 44:["Ad-Dukhān",59], 45:["Al-Jāthiyah",37], 46:["Al-Aḥqāf",35],
  47:["Muḥammad",38], 48:["Al-Fatḥ",29], 49:["Al-Ḥujurāt",18], 50:["Qāf",45],
  51:["Adh-Dhāriyāt",60], 52:["Aṭ-Ṭūr",49], 53:["An-Najm",62], 54:["Al-Qamar",55],
  55:["Ar-Raḥmān",78], 56:["Al-Wāqiʿah",96], 57:["Al-Ḥadīd",29], 58:["Al-Mujādilah",22],
  59:["Al-Ḥashr",24], 60:["Al-Mumtaḥanah",13], 61:["Aṣ-Ṣaff",14], 62:["Al-Jumuʿah",11],
  63:["Al-Munāfiqūn",11], 64:["At-Taghābun",18], 65:["Aṭ-Ṭalāq",12], 66:["At-Taḥrīm",12],
  67:["Al-Mulk",30], 68:["Al-Qalam",52], 69:["Al-Ḥāqqah",52], 70:["Al-Maʿārij",44],
  71:["Nūḥ",28], 72:["Al-Jinn",28], 73:["Al-Muzzammil",20], 74:["Al-Muddaththir",56],
  75:["Al-Qiyāmah",40], 76:["Al-Insān",31], 77:["Al-Mursalāt",50], 78:["An-Nabaʾ",40],
  79:["An-Nāziʿāt",46], 80:["ʿAbasa",42], 81:["At-Takwīr",29], 82:["Al-Infiṭār",19],
  83:["Al-Muṭaffifīn",36], 84:["Al-Inshiqāq",25], 85:["Al-Burūj",22], 86:["Aṭ-Ṭāriq",17],
  87:["Al-Aʿlā",19], 88:["Al-Ghāshiyah",26], 89:["Al-Fajr",30], 90:["Al-Balad",20],
  91:["Ash-Shams",15], 92:["Al-Layl",21], 93:["Aḍ-Ḍuḥā",11], 94:["Ash-Sharḥ",8],
  95:["At-Tīn",8], 96:["Al-ʿAlaq",19], 97:["Al-Qadr",5], 98:["Al-Bayyinah",8],
  99:["Az-Zalzalah",8], 100:["Al-ʿĀdiyāt",11], 101:["Al-Qāriʿah",11], 102:["At-Takāthur",8],
  103:["Al-ʿAṣr",3], 104:["Al-Humazah",9], 105:["Al-Fīl",5], 106:["Quraysh",4],
  107:["Al-Māʿūn",7], 108:["Al-Kawthar",3], 109:["Al-Kāfirūn",6], 110:["An-Naṣr",3],
  111:["Al-Masad",5], 112:["Al-Ikhlāṣ",4], 113:["Al-Falaq",5], 114:["An-Nās",6]
};

const surahSelect = document.getElementById("surahSelect");
const ayahSelect = document.getElementById("ayahSelect");
const wordCount = document.getElementById("wordCount");

for (let i = 1; i <= 114; i++) {
  const [name, count] = surahList[i];
  const opt = new Option(`${i}. ${name} (${count})`, i);
  opt.dataset.count = count;
  surahSelect.appendChild(opt);
}
for (let i = 1; i <= 129; i++) {
  wordCount.appendChild(new Option(i, i));
}
surahSelect.addEventListener("change", updateAyahDropdown);
ayahSelect.addEventListener("change", loadAyat);
wordCount.addEventListener("change", loadAyat);

function updateAyahDropdown() {
  const max = surahSelect.options[surahSelect.selectedIndex].dataset.count;
  ayahSelect.innerHTML = "";
  for (let i = 1; i <= max; i++) {
    ayahSelect.appendChild(new Option(i, i));
  }
  ayahSelect.value = 1;
  loadAyat();
}
async function loadAyat() {
  const s = surahSelect.value;
  const a = ayahSelect.value;
  const wc = +wordCount.value;
  const key = `${s}:${a}`;
  const container = document.getElementById("pages");
  container.innerHTML = "";

  const pageMap = await fetch("https://raw.githubusercontent.com/dickymiswardi/tadabbur/main/ayah_page_map.json").then(r => r.json());
  const page = pageMap[key];
  const fontName = `QCF_P${String(page).padStart(3, '0')}`;
  const fontUrl = `https://cdn.jsdelivr.net/gh/dickymiswardi/quran/fonts/${fontName}.TTF`;

  const style = document.createElement("style");
  style.textContent = `@font-face {
    font-family: '${fontName}';
    src: url('${fontUrl}') format('truetype');
  }`;
  document.head.appendChild(style);

  const div = document.createElement("div");
  div.className = "page-container";
  div.style.fontFamily = fontName;
  container.appendChild(div);

  await document.fonts.load(`1em ${fontName}`);
  const data = await fetch(`https://api.quran.com/api/v4/verses/by_key/${key}?words=true&language=id&translations=33`).then(r => r.json());
  const line = document.createElement("div");

  data.verse.words.slice(0, wc || undefined).forEach(word => {
    const span = document.createElement("span");
    span.className = "word";
    span.innerText = word.code_v1 || word.text;
    const trans = document.createElement("div");
    trans.className = "translation";
    trans.innerText = word.translation?.text || "-";
    span.appendChild(trans);
    span.onclick = () => {
      document.querySelectorAll(".word").forEach(w => w.classList.remove("active"));
      span.classList.add("active");
      setTimeout(() => span.classList.remove("active"), 5000);
    };
    line.appendChild(span);
    line.appendChild(document.createTextNode(" "));
  });

  div.appendChild(line);
  div.style.display = "block";
  requestAnimationFrame(() => div.style.opacity = "1");
}

surahSelect.value = 1;
updateAyahDropdown(); // initial render
</script>

</body>
</html>
